/*! For license information please see content.js.LICENSE.txt */
(()=>{function e(){var t,r,o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",a=o.toStringTag||"@@toStringTag";function c(e,o,i,a){var c=o&&o.prototype instanceof l?o:l,u=Object.create(c.prototype);return n(u,"_invoke",function(e,n,o){var i,a,c,l=0,u=o||[],p=!1,d={p:0,n:0,v:t,a:m,f:m.bind(t,4),d:function(e,n){return i=e,a=0,c=t,d.n=n,s}};function m(e,n){for(a=e,c=n,r=0;!p&&l&&!o&&r<u.length;r++){var o,i=u[r],m=d.p,y=i[2];e>3?(o=y===n)&&(c=i[(a=i[4])?5:(a=3,3)],i[4]=i[5]=t):i[0]<=m&&((o=e<2&&m<i[1])?(a=0,d.v=n,d.n=i[1]):m<y&&(o=e<3||i[0]>n||n>y)&&(i[4]=e,i[5]=n,d.n=y,a=0))}if(o||e>1)return s;throw p=!0,n}return function(o,u,y){if(l>1)throw TypeError("Generator is already running");for(p&&1===u&&m(u,y),a=u,c=y;(r=a<2?t:c)||!p;){i||(a?a<3?(a>1&&(d.n=-1),m(a,c)):d.n=c:d.v=c);try{if(l=2,i){if(a||(o="next"),r=i[o]){if(!(r=r.call(i,c)))throw TypeError("iterator result is not an object");if(!r.done)return r;c=r.value,a<2&&(a=0)}else 1===a&&(r=i.return)&&r.call(i),a<2&&(c=TypeError("The iterator does not provide a '"+o+"' method"),a=1);i=t}else if((r=(p=d.n<0)?c:e.call(n,d))!==s)break}catch(e){i=t,a=1,c=e}finally{l=1}}return{value:r,done:p}}}(e,i,a),!0),u}var s={};function l(){}function u(){}function p(){}r=Object.getPrototypeOf;var d=[][i]?r(r([][i]())):(n(r={},i,function(){return this}),r),m=p.prototype=l.prototype=Object.create(d);function y(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,p):(e.__proto__=p,n(e,a,"GeneratorFunction")),e.prototype=Object.create(m),e}return u.prototype=p,n(m,"constructor",p),n(p,"constructor",u),u.displayName="GeneratorFunction",n(p,a,"GeneratorFunction"),n(m),n(m,a,"Generator"),n(m,i,function(){return this}),n(m,"toString",function(){return"[object Generator]"}),(e=function(){return{w:c,m:y}})()}function n(e,t,r,o){var i=Object.defineProperty;try{i({},"",{})}catch(e){i=0}n=function(e,t,r,o){function a(t,r){n(e,t,function(e){return this._invoke(t,r,e)})}t?i?i(e,t,{value:r,enumerable:!o,configurable:!o,writable:!o}):e[t]=r:(a("next",0),a("throw",1),a("return",2))},n(e,t,r,o)}function t(e,n,t,r,o,i,a){try{var c=e[i](a),s=c.value}catch(e){return void t(e)}c.done?n(s):Promise.resolve(s).then(r,o)}function r(e){return function(){var n=this,r=arguments;return new Promise(function(o,i){var a=e.apply(n,r);function c(e){t(a,o,i,c,s,"next",e)}function s(e){t(a,o,i,c,s,"throw",e)}c(void 0)})}}var o=!1,i="";function a(e,n){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=document.getElementById("page-summarizer-modal");r&&r.remove();var o=document.createElement("div");o.id="page-summarizer-modal",o.style.cssText="\n        position: fixed;\n        top: 0;\n        left: 0;\n        width: 100%;\n        height: 100%;\n        background: rgba(0, 0, 0, 0.5);\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        z-index: 10001;\n        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n    ";var i=document.createElement("div");i.style.cssText="\n        background: white;\n        border-radius: 12px;\n        max-width: 600px;\n        width: 90%;\n        max-height: 80vh;\n        overflow: hidden;\n        box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);\n    ";var a=document.createElement("div");a.style.cssText="\n        background: #8B5CF6;\n        color: white;\n        padding: 16px 20px;\n        display: flex;\n        justify-content: space-between;\n        align-items: center;\n    ",a.innerHTML='\n        <h2 style="margin: 0; font-size: 18px; font-weight: 600;">'.concat(e,'</h2>\n        <button id="close-modal" style="background: none; border: none; color: white; cursor: pointer; font-size: 20px;">√ó</button>\n    ');var c=document.createElement("div");c.style.cssText="\n        padding: 20px;\n        max-height: 60vh;\n        overflow-y: auto;\n    ",c.innerHTML=n;var s=document.createElement("div");return s.style.cssText="\n        padding: 16px 20px;\n        border-top: 1px solid #E5E7EB;\n        display: flex;\n        gap: 12px;\n        justify-content: flex-end;\n    ",t.forEach(function(e){var n=document.createElement("button");n.innerHTML=e.text,n.style.cssText=e.style,n.addEventListener("click",e.onClick),s.appendChild(n)}),i.appendChild(a),i.appendChild(c),i.appendChild(s),o.appendChild(i),a.querySelector("#close-modal").addEventListener("click",function(){return o.remove()}),o.addEventListener("click",function(e){e.target===o&&o.remove()}),document.body.appendChild(o),o}function c(){a("Page Summarizer",'\n        <div style="margin-bottom: 20px;">\n            <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 12px;">\n                <svg width="20" height="20" viewBox="0 0 24 24" fill="#8B5CF6">\n                    <path d="M15.07,11.25L14.17,12.17C13.45,12.89 13,13.5 13,15H11V14.5C11,13.39 11.45,12.39 12.17,11.67L13.41,10.41C13.78,10.05 14,9.55 14,9C14,7.89 13.1,7 12,7A2,2 0 0,0 10,9H8A4,4 0 0,1 12,5A4,4 0 0,1 16,9C16,9.88 15.64,10.68 15.07,11.25M13,19H11V17H13M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2Z" />\n                </svg>\n                <h3 style="margin: 0; color: #374151;">OpenAI API Configuration</h3>\n            </div>\n            <p style="color: #6B7280; margin-bottom: 16px;">Enter your OpenAI API key to enable webpage summarization. Your API key is stored securely and never shared.</p>\n            \n            <div style="margin-bottom: 16px;">\n                <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151;">API KEY</label>\n                <div style="position: relative;">\n                    <input type="password" id="api-key-input" placeholder="sk-proj-..." style="width: 100%; padding: 12px; border: 1px solid #D1D5DB; border-radius: 6px; font-family: monospace;">\n                    <button id="toggle-key-visibility" style="position: absolute; right: 12px; top: 50%; transform: translateY(-50%); background: none; border: none; cursor: pointer;">üëÅÔ∏è</button>\n                </div>\n            </div>\n            \n            <div id="current-key-display" style="margin-bottom: 20px; padding: 12px; background: #F3F4F6; border-radius: 6px; font-family: monospace; font-size: 14px;">\n                Current key: <span id="current-key-text">Not set</span>\n            </div>\n            \n            <div>\n                <h4 style="margin: 0 0 8px 0; color: #374151;">How to get your API key:</h4>\n                <ol style="margin: 0; padding-left: 20px; color: #6B7280;">\n                    <li><a href="https://platform.openai.com/api-keys" target="_blank" style="color: #8B5CF6;">Go to OpenAI API Keys</a></li>\n                    <li>Sign in or create an account</li>\n                    <li>Click "Create new secret key"</li>\n                    <li>Copy the key and paste it above</li>\n                </ol>\n            </div>\n        </div>\n    ',[{text:"Save API Key",style:"background: #8B5CF6; color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; font-weight: 500;",onClick:s},{text:"üóëÔ∏è Clear Key",style:"background: white; color: #DC2626; border: 1px solid #DC2626; padding: 10px 20px; border-radius: 6px; cursor: pointer; font-weight: 500;",onClick:l}]),chrome.storage.local.get(["openai_api_key"],function(e){var n=document.getElementById("current-key-text"),t=document.getElementById("api-key-input");if(e.openai_api_key){var r=e.openai_api_key.substring(0,8)+"..."+e.openai_api_key.substring(e.openai_api_key.length-4);n.textContent=r,t.value=e.openai_api_key}});var e=document.getElementById("toggle-key-visibility"),n=document.getElementById("api-key-input");e.addEventListener("click",function(){"password"===n.type?(n.type="text",e.textContent="üôà"):(n.type="password",e.textContent="üëÅÔ∏è")})}function s(){var e=document.getElementById("api-key-input").value.trim();e?e.startsWith("sk-")?chrome.storage.local.set({openai_api_key:e},function(){document.getElementById("page-summarizer-modal").remove(),alert("API key saved successfully!")}):alert('Please enter a valid OpenAI API key (should start with "sk-")'):alert("Please enter an API key")}function l(){confirm("Are you sure you want to clear your API key?")&&chrome.storage.local.remove(["openai_api_key"],function(){document.getElementById("page-summarizer-modal").remove(),alert("API key cleared")})}function u(e){i=e;var n=a("Page Summarizer",'\n        <div style="line-height: 1.6; color: #374151;">\n            '.concat(e.split("\n").map(function(e){return'<p style="margin-bottom: 16px;">'.concat(e,"</p>")}).join(""),'\n        </div>\n        <div style="margin-top: 20px; text-align: right;">\n            <button id="copy-summary" style="background: #8B5CF6; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-weight: 500;">Copy</button>\n        </div>\n    '),[{text:"Discard",style:"background: white; color: #6B7280; border: 1px solid #D1D5DB; padding: 10px 20px; border-radius: 6px; cursor: pointer; font-weight: 500;",onClick:function(){return n.remove()}},{text:"Save",style:"background: #8B5CF6; color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; font-weight: 500;",onClick:p}]);document.getElementById("copy-summary").addEventListener("click",function(){navigator.clipboard.writeText(e).then(function(){alert("Summary copied to clipboard!")})})}function p(){var e=JSON.parse(localStorage.getItem("page-summaries")||"[]");e.push({url:window.location.href,title:document.title,summary:i,timestamp:(new Date).toISOString()}),localStorage.setItem("page-summaries",JSON.stringify(e)),document.getElementById("page-summarizer-modal").remove(),alert("Summary saved!")}function d(){return m.apply(this,arguments)}function m(){return m=r(e().m(function n(){return e().w(function(n){for(;;)switch(n.n){case 0:if(!o){n.n=1;break}return n.a(2);case 1:chrome.storage.local.get(["openai_api_key"],function(){var n=r(e().m(function n(t){return e().w(function(e){for(;;)switch(e.n){case 0:if(t.openai_api_key){e.n=1;break}return c(),e.a(2);case 1:return e.n=2,y(t.openai_api_key);case 2:return e.a(2)}},n)}));return function(e){return n.apply(this,arguments)}}());case 2:return n.a(2)}},n)})),m.apply(this,arguments)}function y(e){return f.apply(this,arguments)}function f(){return(f=r(e().m(function n(t){var r,i,a,c;return e().w(function(e){for(;;)switch(e.p=e.n){case 0:return o=!0,r=document.getElementById("page-summarizer-btn"),i=r.innerHTML,r.innerHTML="‚è≥ Summarizing...",r.disabled=!0,e.p=1,a=g(),e.n=2,h(a,t);case 2:u(e.v),e.n=4;break;case 3:e.p=3,c=e.v,console.error("Summarization error:",c),alert("Error generating summary. Please check your API key and try again.");case 4:return e.p=4,o=!1,r.innerHTML=i,r.disabled=!1,e.f(4);case 5:return e.a(2)}},n,null,[[1,3,4,5]])}))).apply(this,arguments)}function g(){document.querySelectorAll("script, style, nav, header, footer, aside").forEach(function(e){return e.remove()});var e=document.querySelector("main, article, .content, #content")||document.body;return(e.innerText||e.textContent||"").replace(/\s+/g," ").replace(/\n+/g,"\n").trim().substring(0,8e3)}function h(e,n){return v.apply(this,arguments)}function v(){return(v=r(e().m(function n(t,r){var o,i;return e().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(r)},body:JSON.stringify({model:"gpt-3.5-turbo",messages:[{role:"system",content:"You are a helpful assistant that creates concise, informative summaries of web page content. Focus on the main points and key information."},{role:"user",content:"Please summarize the following web page content:\n\n".concat(t)}],max_tokens:500,temperature:.7})});case 1:if((o=e.v).ok){e.n=2;break}throw new Error("OpenAI API error: ".concat(o.status));case 2:return e.n=3,o.json();case 3:return i=e.v,e.a(2,i.choices[0].message.content)}},n)}))).apply(this,arguments)}function b(){!function(){var e=document.getElementById("page-summarizer-btn");e&&e.remove();var n=document.createElement("button");n.id="page-summarizer-btn",n.innerHTML='\n        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">\n            <path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z" />\n        </svg>\n        Summarize\n        <svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor">\n            <path d="M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M12,4A8,8 0 0,1 20,12A8,8 0 0,1 12,20A8,8 0 0,1 4,12A8,8 0 0,1 12,4M12,6A6,6 0 0,0 6,12A6,6 0 0,0 12,18A6,6 0 0,0 18,12A6,6 0 0,0 12,6M12,8A4,4 0 0,1 16,12A4,4 0 0,1 12,16A4,4 0 0,1 8,12A4,4 0 0,1 12,8Z" />\n        </svg>\n    ',n.style.cssText="\n        position: fixed;\n        top: 20px;\n        left: 20px;\n        background: #8B5CF6;\n        color: white;\n        border: none;\n        padding: 12px 16px;\n        border-radius: 8px;\n        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n        font-size: 14px;\n        font-weight: 500;\n        cursor: pointer;\n        z-index: 10000;\n        box-shadow: 0 4px 12px rgba(139, 92, 246, 0.3);\n        display: flex;\n        align-items: center;\n        gap: 8px;\n        transition: all 0.2s ease;\n    ",n.addEventListener("mouseenter",function(){n.style.background="#7C3AED",n.style.transform="translateY(-1px)"}),n.addEventListener("mouseleave",function(){n.style.background="#8B5CF6",n.style.transform="translateY(0)"}),n.addEventListener("click",d),document.body.appendChild(n)}()}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",b):b()})();